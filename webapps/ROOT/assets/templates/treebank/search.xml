<?xml version="1.0" encoding="UTF-8"?>
<kiln:root xmlns:h="http://apache.org/cocoon/request/2.0"
           xmlns:tei="http://www.tei-c.org/ns/1.0"
           xmlns:xi="http://www.w3.org/2001/XInclude"
           xmlns:kiln="http://www.kcl.ac.uk/artshums/depts/ddh/kiln/ns/1.0"
           xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <xsl:param name="query-string"/>

  <xsl:import href="cocoon://_internal/template/xsl/stylesheets/solr/results-to-html.xsl"/>

  <xsl:variable name="q_value" select="normalize-space(/aggregation/h:request/h:requestParameters/h:parameter[@name='q']/h:value)" />
  <xsl:variable name="df_value" select="normalize-space(/aggregation/h:request/h:requestParameters/h:parameter[@name='df']/h:value)" />

  <xsl:variable name="metadata_fields" select="('text_corpus', 'text_century', 'text_century_earliest', 'text_century_latest', 'text_century_minimal_range', 'text_genre', 'text_author', 'text_language_type', 'text_verse_type', 'text_language_proficiency', 'w_sentence_id_string')"/>
  <xsl:variable name="morphology_fields" select="('w_pos', 'w_number', 'w_case', 'w_gender', 'w_degree', 'w_mood', 'w_tense', 'w_voice', 'w_lemma', 'w_person')"/>
  <xsl:variable name="syntax_fields" select="('w_relation', 'w_agrees_with_governor', 'w_is_ag', 'w_is_attributive', 'w_has_article', 'w_article_case', 'w_has_ds')"/>
  <xsl:variable name="semantics_fields" select="('w_animacy', 'w_is_proper_name')"/>
  <xsl:variable name="first_governor_fields" select="('w_first_head_lemma', 'w_first_governor_pos', 'w_first_governor_relation', 'w_first_governor_is_root', 'w_first_head_is_name', 'w_first_head_animacy', 'w_first_head_case', 'w_first_head_gender', 'w_first_head_mood', 'w_first_head_number', 'w_first_head_pos', 'w_first_head_relation', 'w_first_head_tense', 'w_first_head_has_article', 'w_first_head_other_modifiers')"/>
  <xsl:variable name="first_dependent_fields" select="('w_first_level_dependent_lemma', 'w_first_level_dependent_mood', 'w_first_level_dependent_case', 'w_first_level_dependent_number', 'w_first_level_dependent_person', 'w_first_level_dependent_pos', 'w_first_level_dependent_relation', 'w_first_level_dependent_tense')"/>
  <xsl:variable name="other_fields" select="('sentence_b_w_o_pattern', 'w_position_in_np', 'w_position_in_np_full', 'w_is_next_to_governor')"/>
  
  <kiln:parent>
    <xi:include href="base.xml" />
  </kiln:parent>

  <kiln:child>
    <kiln:block name="title">
      <kiln:super />
      <xsl:text>Search</xsl:text>
    </kiln:block>

    <kiln:block name="page-heading">
      <kiln:super />
      <xsl:text>Search</xsl:text>
    </kiln:block>

    <kiln:block name="content">
      <div class="uk-grid">
        <div class="uk-width-1-4">
          <form action="{kiln:url-for-match('word-search', (), 0)}" id="search-form" method="get">
            <div>
              <label class="label">Word</label>
              <input class="uk-input" name="q" placeholder="Search word" type="search">
                <xsl:attribute name="value">
                  <xsl:value-of select="$q_value" />
                </xsl:attribute>
              </input>
            </div>
            <div>
              <label class="checkbox">
                <input name="df" type="checkbox" value="w_form">
                  <xsl:if test="$df_value = 'w_form'">
                    <xsl:attribute name="checked">checked</xsl:attribute>
                  </xsl:if>
                </input>
                <xsl:text> Search word forms</xsl:text>
              </label>
              <xsl:apply-templates mode="search-query" select="/aggregation/response/lst[@name='responseHeader']/lst[@name='params']/*[@name='fq']" />
            </div>
          </form>
          <!-- List available facets. -->
          <xsl:apply-templates select="/aggregation/response/lst[@name='facet_counts']/lst[@name='facet_fields']" mode="search-results" />
        </div>
        <div class="uk-width-3-4">
          <!-- List of currently applied facets. -->
          <xsl:apply-templates mode="search-results" select="/aggregation/response/lst[@name='responseHeader']/lst[@name='params']/*[@name='fq']" />
          <!-- List results. -->
          <xsl:apply-templates select="/aggregation/response/result" mode="search-results" />
          <p>
            <a href="{kiln:url-for-match('search-citation', (), 0)}?{$query-string}&amp;rows=100">Citations (first 100)</a>
          </p>
        </div>
      </div>
    </kiln:block>

  </kiln:child>

</kiln:root>
